---
layout: post
title: CMake实践
description: 从DALI开始
summary: 直接阅读项目CMake
comments: true
tags: [cmake, build, project]
---

# CMake实践


## 实践1: DALI项目


### 思路

    色彩空间转的实现在/dali/operators/image/color.
    为了能够对色彩空间转换功能debug,需要找到调试入口


#### 0x01
color路径下CMakeLists.txt
```
collect_headers(DALI_INST_HDRS PARENT_SCOPE)
collect_sources(DALI_OPERATOR_SRCS PARENT_SCOPE)
collect_test_sources(DALI_OPERATOR_TEST_SRCS PARENT_SCOPE)
```
collect_test_sources宏定义为:
```
macro(collect_test_sources DALI_TEST_SRCS_GROUP)
  cmake_parse_arguments(
    COLLECT_TEST_SOURCES # prefix of output variables
    "PARENT_SCOPE" # all options for the respective macro
    "" # one value keywords
    "" # multi value keywords
    ${ARGV})

  file(GLOB collect_test_sources_tmp_test *_test.cc *_test.cu *_test.c)
  set(${DALI_TEST_SRCS_GROUP} ${${DALI_TEST_SRCS_GROUP}} ${collect_test_sources_tmp_test})
  if (COLLECT_TEST_SOURCES_PARENT_SCOPE)
    set(${DALI_TEST_SRCS_GROUP} ${${DALI_TEST_SRCS_GROUP}} PARENT_SCOPE)
  endif()
endmacro()
```
这说明宏collect_test_sources的参数名开头都将附加`COLLECT_TEST_SOURCES_`

如果调用宏时,参数中传入了PARENT_SCOPE,则COLLECT_TEST_SOURCES_PARENT_SCOPE将设置为TRUE

在调用`collect_sources(DALI_OPERATOR_SRCS PARENT_SCOPE)`中,collect_test_sources_tmp_test保存了color目录下所有test的文件,然后将这些文件叠加并存储到DALI_OPERATOR_SRCS变量中

#### 0x02
